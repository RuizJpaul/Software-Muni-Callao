<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GestiÃ³n Comedores - Plantilla Completa</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
    tailwind.config = { theme: { extend: { colors: { callaoBlue: '#0057B7', callaoYellow: '#FFC20E', callaoPurple: '#6B21A8' } } } };
  </script>
</head>
<body class="flex h-screen bg-gradient-to-r from-blue-50 to-purple-50">

  <aside id="sidebar" class="bg-gradient-to-b from-callaoPurple to-callaoBlue text-white w-60 fixed h-full shadow-lg transform -translate-x-full lg:translate-x-0 transition-transform">
    <div class="flex items-center justify-between h-16 px-4 border-b border-purple-700">
      <span class="text-3xl font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-callaoYellow to-red-500">ğŸŒŠ Callao</span>
      <button id="btnSidebarClose" class="lg:hidden text-2xl">&times;</button>
    </div>
    <nav class="p-4 space-y-1">
      <button onclick="showSection('dashboard')" class="w-full text-left flex items-center px-3 py-2 rounded-lg hover:bg-purple-700 transition">ğŸ <span class="ml-2">Dashboard</span></button>
      <button onclick="showSection('comedor')" class="w-full text-left flex items-center px-3 py-2 rounded-lg hover:bg-purple-700 transition">ğŸ›ï¸<span class="ml-2">Comedores</span></button>
      <button onclick="showSection('beneficiarios')" class="w-full text-left flex items-center px-3 py-2 rounded-lg hover:bg-purple-700 transition">ğŸ‘¥<span class="ml-2">Beneficiarios</span></button>
      <button onclick="showSection('entregas')" class="w-full text-left flex items-center px-3 py-2 rounded-lg hover:bg-purple-700 transition">ğŸ½ï¸<span class="ml-2">Entregas</span></button>
      <button onclick="showSection('usuarios')" class="w-full text-left flex items-center px-3 py-2 rounded-lg hover:bg-purple-700 transition">ğŸ”’<span class="ml-2">Usuarios</span></button>
      <button onclick="showSection('panel')" class="w-full text-left flex items-center px-3 py-2 rounded-lg hover:bg-purple-700 transition">ğŸ“Š<span class="ml-2">Panel</span></button>
      <button onclick="showSection('auditoria')" class="w-full text-left flex items-center px-3 py-2 rounded-lg hover:bg-purple-700 transition">ğŸ•µï¸<span class="ml-2">AuditorÃ­a</span></button>
    </nav>
  </aside>


  <div class="flex-1 flex flex-col ml-60">

    <header class="h-16 bg-gradient-to-r from-pink-500 to-red-500 flex items-center px-6 shadow-md">
      <button id="btnSidebarOpen" class="lg:hidden mr-4 text-2xl text-white">&#9776;</button>
      <h1 id="page-title" class="text-2xl font-bold text-white">Dashboard ğŸ‰</h1>
    </header>
    <main class="flex-1 overflow-y-auto p-6">
  
      <section id="dashboard" class="space-y-6">
        <p class="text-gray-700">Bienvenido al sistema de gestiÃ³n de comedores populares.</p>
      </section>

      <section id="comedor" class="hidden"><h2 class="text-2xl font-semibold mb-4 text-callaoYellow">MÃ³dulo Comedores</h2></section>
      <section id="beneficiarios" class="hidden"><h2 class="text-2xl font-semibold mb-4 text-callaoBlue">MÃ³dulo Beneficiarios</h2></section>

      <section id="entregas" class="hidden">
        <h2 class="text-2xl font-semibold mb-4 text-callaoPurple">Registro de Entregas</h2>
        <div class="overflow-x-auto">
          <table class="min-w-full bg-white rounded-lg shadow">
            <thead class="bg-callaoBlue text-white">
              <tr>
                <th class="py-2 px-4">DNI</th>
                <th class="py-2 px-4">Nombre</th>
                <th class="py-2 px-4">Comedor</th>
                <th class="py-2 px-4">Estado</th>
                <th class="py-2 px-4">Fecha</th>
                <th class="py-2 px-4">Hora</th>
                <th class="py-2 px-4">Veces</th>
                <th class="py-2 px-4">Acciones</th>
              </tr>
            </thead>
            <tbody id="entregas-body"></tbody>
          </table>
        </div>
      </section>
      <section id="usuarios" class="hidden"><h2 class="text-2xl font-semibold mb-4 text-green-600">MÃ³dulo Usuarios</h2></section>
      <section id="panel" class="hidden"><h2 class="text-2xl font-semibold mb-4 text-yellow-600">Panel de AdministraciÃ³n</h2></section>
      <section id="auditoria" class="hidden"><h2 class="text-2xl font-semibold mb-4 text-red-600">AuditorÃ­a y Logs</h2></section>
    </main>

    <footer class="h-12 bg-gradient-to-r from-callaoBlue to-indigo-700 flex items-center justify-center text-white">
      <span class="text-sm">v1.0 â€¢ Municipalidad Provincial del Callao</span>
    </footer>
  </div>

  <script>

    let beneficiaries = JSON.parse(localStorage.getItem('deliveries')) || [
      { dni: '07564321', name: 'MarÃ­a Quispe', comedor: 'Virgen del Carmen', status: 'Pendiente', count: 0, fechaEntrega: null },
      { dni: '46982137', name: 'Carlos Ramos', comedor: 'San Pedro', status: 'Pendiente', count: 0, fechaEntrega: null },
      { dni: '12345678', name: 'Ana Torres', comedor: 'Santa Rosa de Lima', status: 'Pendiente', count: 0, fechaEntrega: null }
    ];
    let corrections = JSON.parse(localStorage.getItem('corrections')) || [];
    function saveData() {
      localStorage.setItem('deliveries', JSON.stringify(beneficiaries));
      localStorage.setItem('corrections', JSON.stringify(corrections));
    }


    function showSection(id) {
      document.querySelectorAll('main section').forEach(s => s.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
      const titles = { dashboard: 'Dashboard ğŸ‰', comedor: 'Comedores', beneficiarios: 'Beneficiarios', entregas: 'Registro Entregas', usuarios: 'Usuarios', panel: 'Panel', auditoria: 'AuditorÃ­a' };
      document.getElementById('page-title').innerText = titles[id] || '';
      if (id === 'entregas') renderEntregas();
    }


    function formatDateTime(dt) {
      return { fecha: dt.toLocaleDateString('es-PE'), hora: dt.toLocaleTimeString('es-PE', { hour: '2-digit', minute: '2-digit' }) };
    }


    function renderEntregas() {
      const tbody = document.getElementById('entregas-body'); tbody.innerHTML = '';
      beneficiaries.forEach((b, i) => {
        const tr = document.createElement('tr'); tr.className = 'border-b';
        const { fecha, hora } = b.fechaEntrega ? formatDateTime(new Date(b.fechaEntrega)) : { fecha: '', hora: '' };
        tr.innerHTML = `
          <td class="py-2 px-4">${b.dni}</td>
          <td class="py-2 px-4">${b.name}</td>
          <td class="py-2 px-4">${b.comedor}</td>
          <td id="status-${i}" class="py-2 px-4">${b.status}</td>
          <td id="fecha-${i}" class="py-2 px-4">${fecha}</td>
          <td id="hora-${i}" class="py-2 px-4">${hora}</td>
          <td id="count-${i}" class="py-2 px-4">${b.count}</td>
          <td class="py-2 px-4">
            <button id="btn-${i}" class="bg-callaoYellow text-white px-3 py-1 rounded hover:opacity-90 transition">Entregar</button>
            <button id="edit-${i}" class="bg-gray-300 text-black px-3 py-1 rounded ml-2 hover:bg-gray-400 transition">Editar</button>
          </td>
        `;
        tbody.appendChild(tr);


        document.getElementById(`btn-${i}`).addEventListener('click', () => {
          const now = new Date(), today = now.toLocaleDateString('es-PE'), last = b.fechaEntrega ? new Date(b.fechaEntrega).toLocaleDateString('es-PE') : null;
          const doDeliver = () => {
            b.status = 'Entregado'; b.fechaEntrega = now.toISOString(); b.count++;
            saveData(); renderEntregas();
          };
          if (last === today) {
            Swal.fire({ title: 'Entrega duplicada hoy', text: 'Â¿Agregar de todas formas?', icon: 'warning', showCancelButton: true, confirmButtonText: 'SÃ­, agregar', cancelButtonText: 'No' })
              .then(res => res.isConfirmed && doDeliver());
          } else doDeliver();
        });


        document.getElementById(`edit-${i}`).addEventListener('click', () => {
          Swal.fire({
            title: 'Corregir entrega',
            html: `
              <p class="mb-2">Beneficiario: ${b.name} (${b.dni})</p>
              <input id="swal-name" class="swal2-input" placeholder="Tu nombre" />
              <input id="swal-dni" class="swal2-input" placeholder="Tu DNI" />`,
            focusConfirm: false,
            showCancelButton: true,
            preConfirm: () => {
              const userName = document.getElementById('swal-name').value;
              const userDNI  = document.getElementById('swal-dni').value;
              if (!userName || !userDNI) Swal.showValidationMessage('Nombre y DNI son obligatorios');
              return { userName, userDNI };
            }
          }).then(result => {
            if (result.isConfirmed) {
              if (b.count > 0) b.count--;
              corrections.push({ beneficiario: b.dni, corregidoPor: result.value.userName, dniCorregidoPor: result.value.userDNI, fecha: new Date().toISOString() });
              saveData(); renderEntregas();
              Swal.fire('Corregido', 'Se ha registrado la correcciÃ³n y ajustado el contador.', 'success');
            }
          });
        });
      });
    }


    const sidebar = document.getElementById('sidebar');
    document.getElementById('btnSidebarOpen').onclick = () => sidebar.classList.remove('-translate-x-full');
    document.getElementById('btnSidebarClose').onclick = () => sidebar.classList.add('-translate-x-full');


    showSection('dashboard');
    saveData();
  </script>
</body>
</html>
